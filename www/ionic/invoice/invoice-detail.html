<ion-view title="票据详情页" id="page20">
    <ion-content padding="false" class="has-header" scroll="false">
        <div class="list invoice-info">
            <div class="item item_line">{{statustext[tripDetail.status]}}<span class="item-note">{{invoices.length}}张票据</span></div>
            <div class="item item_line">
                <span>{{tripDetail.createdAt | date: 'yyyy-MM-dd'}}</span>
                <span ng-if="tripDetail.type == EInvoiceType.HOTEL">
                    <b>{{tripDetail.h_city.name}}</b>
                    <b ng-if="tripDetail.hotelName"> - {{invoice.hotelName}}</b>
                </span>
                <span ng-if="tripDetail.type != EInvoiceType.HOTEL">
                    <b>{{tripDetail.d_city.name}}</b>-
                    <b>{{tripDetail.a_city.name}}</b>
                </span>
            </div>
            <div class="item money_info">
                <div class="expenditure_pay">
                    <span>实际支出</span>
                    <br/>
                    <span>{{tripDetail.expenditure}}</span>
                </div>=
                <div class="company_pay">
                    <span>公司支付</span>
                    <br/>
                    <span>{{tripDetail.expenditure - tripDetail.personalExpenditure}}</span>
                </div>
                +
                <div class="personal_pay">
                    <span>个人支付</span>
                    <br/>
                    <span>{{tripDetail.personalExpenditure | currency_int}}</span>
                </div>
            </div>

        </div>
        <ion-slide-box class="item item-image"
                       show-pager="true"
                       active-slide="0">
            <ion-slide  ng-repeat="invoice in invoices track by $index">
                <div class="invoice-form" ng-if="invoice.sourceType == '1' && !invoice.edit">
                    <div class="invoice-img">
                        <img ng-src="{{invoice.imgUrl}}" ng-click="imgView(invoice.imgUrl)">
                        <div>
                            <span class="item-tit">金额</span>
                            <h3>{{invoice.totalMoney}}</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">支付方式</span>
                            <h3 ng-if="invoice.payType == 1">个人支付</h3>
                            <h3 ng-if="invoice.payType == 2">公司支付</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">类型</span>
                            <h3 ng-if="invoice.type == 1">机票</h3>
                            <h3 ng-if="invoice.type == 2">火车票</h3>
                            <h3 ng-if="invoice.type == 3">火车退票费</h3>
                            <h3 ng-if="invoice.type == 4">机票退票费</h3>
                            <h3 ng-if="invoice.type == 5">酒店</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">时间</span>
                            <h3>{{invoice.invoiceDateTime | date: 'yyyy-MM-dd'}}</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div class="invoice_desc">
                            <span class="item-tit">备注</span>
                            <p>{{invoice.remark}}</p>
                        </div>
                    </div>
                    <div class="button-bar" ng-if="[EPlanStatus.AUDIT_NOT_PASS,EPlanStatus.WAIT_UPLOAD,EPlanStatus.WAIT_COMMIT].indexOf(tripDetail.status) >= 0">
                        <a class="button button-outline button-calm" ng-click="deleteInvoice(invoice)">删除</a>
                        <a class="button button-outline button-calm" ng-click="editNow(invoice)">修改</a>
                    </div>
                </div>
                <div class="invoice-form invoice-edit" ng-if="invoice.sourceType == '1' && invoice.edit">
                    <div class="invoice-img">
                        <div class="invoice-img-min" ng-uploader="" accept="image/png, image/jpeg, image/gif" url="uploadUrl" done="invoicefuc.done">
                            <img ng-if="previewUrl" ng-src="{{previewUrl}}">
                            <img ng-if="!previewUrl" ng-src="{{invoice.imgUrl}}">
                            <a class="button button-positive">点击重传</a>
                        </div>
                        <div>
                            <span class="item-tit">金额</span>
                            <h3><input type="text" oninput="if(value.length>5)value=value.slice(0,5)" ng-model="invoice.totalMoney"></h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">支付方式</span>
                        <div class="item-select">
                            <h3>
                                <select ng-model="invoice.payType">
                                    <option value="1" ng-selected="invoice.payType == 1">个人支付</option>
                                    <option value="2" ng-selected="invoice.payType == 2">公司支付</option>
                                </select>
                            </h3><!-- 这里要加一个判断,是否是编辑模式,,-->
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">类型</span>
                        <div class="item-select">
                            <!--<h3>类型</h3>-->
                            <h3>
                                <select ng-model="invoice.type">
                                    <option value="1" ng-selected="invoice.type == 1">机票</option>
                                    <option value="2" ng-selected="invoice.type == 2">火车票</option>
                                    <option value="3" ng-selected="invoice.type == 3">火车退票费</option>
                                    <option value="4" ng-selected="invoice.type == 4">机票退票费</option>
                                    <option value="5" ng-selected="invoice.type == 5">酒店</option>
                                </select>
                            </h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">时间</span>
                        <div>
                            <h3>
                                <ng-selector-date ng-model="invoice.invoiceDateTime"
                                                  dlg-title="请选择出差日期"
                                                  dlg-options="dateOptions"
                                                  date-filter="yyyy-MM-dd">
                                </ng-selector-date>
                            </h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">备注</span>
                        <textarea ng-model="invoice.remark"></textarea>
                    </div>
                    <div class="button-bar">
                        <a class="button button-outline button-calm" ng-click="cancelChanges(invoice)">取消</a>
                        <a class="button button-outline button-calm" ng-click="saveChanges(invoice)">确认</a>
                    </div>
                </div>
                <div class="invoice-form from-supplier" ng-if="invoice.sourceType == '2' && !invoice.edit">
                    <div class="invoice-img">
                        <img ng-src="/attachments/{{invoice.supplier.logo}}">
                        <!--<div class="supplier_logo"></div>-->
                        <div>
                            <span class="item-tit">金额</span>
                            <h3>{{invoice.totalMoney}}</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">支付方式</span>
                            <h3 ng-if="invoice.payType == 1">个人支付</h3>
                            <h3 ng-if="invoice.payType == 2">公司支付</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">类型</span>
                            <h3 ng-if="invoice.type == 1">机票</h3>
                            <h3 ng-if="invoice.type == 2">火车票</h3>
                            <h3 ng-if="invoice.type == 3">火车退票费</h3>
                            <h3 ng-if="invoice.type == 4">机票退票费</h3>
                            <h3 ng-if="invoice.type == 5">酒店</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">时间</span>
                            <h3>{{invoice.invoiceDateTime | date: 'yyyy-MM-dd'}}</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div class="invoice_desc">
                            <span class="item-tit">备注</span>
                            <p>{{invoice.remark}}</p>
                        </div>
                    </div>
                    <div class="button-bar" ng-if="[EPlanStatus.AUDIT_NOT_PASS,EPlanStatus.WAIT_UPLOAD,EPlanStatus.WAIT_COMMIT].indexOf(tripDetail.status) >= 0">
                        <a class="button button-outline button-calm" ng-click="unBind(invoice)">解除绑定</a>
                    </div>
                </div>
            </ion-slide>
            <ion-slide ng-class="{'noflex':!select_menu,'chooseFun':select_menu}" ng-if="[EPlanStatus.AUDIT_NOT_PASS,EPlanStatus.WAIT_UPLOAD,EPlanStatus.WAIT_COMMIT].indexOf(tripDetail.status) >= 0">
                <div ng-if="select_menu" class="chooseBtn" ng-class="{'invoice-form':!select_menu}">
                    <a class="button button-calm" ng-click="linkOthers()">关联订单</a>
                    <a class="button button-calm button-outline" ng-click="manual()">手动添加</a>
                </div>
                <div class="addInvoice invoice-form invoice-edit" ng-if="!select_menu">
                    <div class="invoice-img">
                        <div class="invoice-img-min" ng-uploader="" accept="image/png, image/jpeg, image/gif" url="uploadUrl" done="invoicefuc.done">
                            <img ng-if="previewUrl" ng-src="{{previewUrl}}">
                            <img ng-if="!previewUrl" src="ionic/images/add_img.png">
                            <a ng-if="previewUrl" class="button button-positive">点击重传</a>
                        </div>
                        <div>
                            <span class="item-tit">金额</span>
                            <h3><input type="number" oninput="if(value.length>5)value=value.slice(0,5)" ng-model="newInvoice.totalMoney"></h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">支付方式</span>
                        <div class="item-select">
                            <h3>
                                <select ng-model="newInvoice.payType">
                                    <option value="1" ng-selected="newInvoice.payType == 1">个人支付</option>
                                    <option value="2" ng-selected="newInvoice.payType == 2">公司支付</option>
                                </select>
                            </h3><!-- 这里要加一个判断,是否是编辑模式,,-->
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">类型</span>
                        <div class="item-select">
                            <!--<h3>类型</h3>-->
                            <h3>
                                <select ng-model="newInvoice.type">
                                    <option value="1" ng-selected="newInvoice.type == 1">机票</option>
                                    <option value="2" ng-selected="newInvoice.type == 2">火车票</option>
                                    <option value="3" ng-selected="newInvoice.type == 3">火车退票费</option>
                                    <option value="4" ng-selected="newInvoice.type == 4">机票退票费</option>
                                </select>
                            </h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">时间</span>
                        <div>
                            <!--<h3>2016-05-23</h3>-->
                            <h3>
                                <ng-selector-date ng-model="newInvoice.invoiceDateTime"
                                                  dlg-title="请选择出差日期"
                                                  dlg-options="dateOptions"
                                                  date-filter="yyyy-MM-dd">
                                </ng-selector-date>
                            </h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">备注</span>
                        <textarea ng-model="newInvoice.remark"></textarea>
                    </div>
                    <div class="button-bar">
                        <a class="button button-outline button-calm" ng-click="backToChooese()">取消</a>
                        <a class="button button-outline button-calm" ng-click="createInvoice()">确认</a>
                    </div>
                </div>
            </ion-slide>
        </ion-slide-box>
    </ion-content>
    <div class="bar bar-footer bar-positive" ng-if="invoice.status == EPlanStatus.WAIT_COMMIT || invoice.status == EPlanStatus.AUDIT_NOT_PASS">
        <div class="button button-full button-positive" style="margin-top: 0;width: 100%;font-size: 20px;" ng-uploader accept="image/png, image/jpeg, image/gif" title="invoicefuc.title" done="invoicefuc.done" url="uploadUrl">重新上传</div>
    </div>
    <div class="bar bar-footer bar-positive" ng-if="invoice.status == EPlanStatus.AUDITING || invoice.status == EPlanStatus.COMPLETE">
        <div class="button button-full button-positive" style="margin-top: 0;width: 100%;font-size: 20px;" ng-click="backtodetail()">返回详情</div>
    </div>
</ion-view>