<ion-view title="票据详情页" id="page20">
    <ion-content padding="false" class="has-header invoices" scroll="false">
        <div class="list invoice-info">
            <div class="item item_line">{{statustext[tripDetail.status]}}
                <span class="item-note">{{invoices.length}}张票据</span>
            </div>
            <div class="item item_line">
                <span ng-if="tripDetail.type != EInvoiceType.HOTEL">{{tripDetail.deptDateTime | date: 'MM.dd'}}</span>
                <span ng-if="tripDetail.type == EInvoiceType.HOTEL">
                    {{tripDetail.checkInDate | date: 'MM.dd'}} - {{tripDetail.checkOutDate | date: 'MM.dd'}}
                </span>
                <span ng-if="tripDetail.type == EInvoiceType.HOTEL">
                    <b>{{tripDetail.h_city.name}}</b>
                    <b ng-if="tripDetail.hotelName"> - {{invoice.hotelName}}</b>
                </span>
                <span ng-if="tripDetail.type != EInvoiceType.HOTEL">
                    <b>{{tripDetail.d_city.name}}</b>-
                    <b>{{tripDetail.a_city.name}}</b>
                </span>
            </div>
            <div class="item money_info">
                <div class="expenditure_pay">
                    <span>实际支出</span>
                    <br/>
                    <span>{{tripDetail.expenditure}}</span>
                </div>=
                <div class="company_pay">
                    <span>公司支付</span>
                    <br/>
                    <span>{{tripDetail.expenditure - tripDetail.personalExpenditure}}</span>
                </div>
                +
                <div class="personal_pay">
                    <span>个人支付</span>
                    <br/>
                    <span>{{tripDetail.personalExpenditure | currency_int}}</span>
                </div>
            </div>
        </div>
        <ion-slide-box class="item item-image"
                       show-pager="true"
                       active-slide="initPager">
            <ion-slide  ng-repeat="invoice in invoices track by $index">
                <div class="invoice-form" ng-if="invoice.sourceType == '1' && !invoice.edit">
                    <div class="invoice-img">
                        <img ng-src="{{invoice.imgUrl}}" ng-click="imgView(invoice.imgUrl)">
                        <div>
                            <span class="item-tit">金额</span>
                            <h3>{{invoice.totalMoney}}</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">支付方式</span>
                            <h3 ng-if="invoice.payType == EPayType.PERSONAL_PAY">个人支付</h3>
                            <h3 ng-if="invoice.payType == EPayType.COMPANY_PAY">公司支付</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">类型</span>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.PLANE_TICKET">机票行程单</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.TRAIN_TICKET">火车票</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.HOTEL">住宿费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.ORDER_TICKET_FEE">订票费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.CANCEL_TICKET_FEE">退票费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.TICKET_CHANGE_FEE">改签费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.EXPRESS">快递费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.INSURANCE">保险费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.OTHER">其他</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">时间</span>
                            <h3>{{invoice.invoiceDateTime | date: 'yyyy-MM-dd'}}</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div class="invoice_desc">
                            <span class="item-tit">备注</span>
                            <p>{{invoice.remark}}</p>
                        </div>
                    </div>
                    <div class="button-bar" ng-if="[EPlanStatus.AUDIT_NOT_PASS,EPlanStatus.WAIT_UPLOAD,EPlanStatus.WAIT_COMMIT].indexOf(tripDetail.status) >= 0">
                        <a class="button button-outline button-calm" ng-click="deleteInvoice(invoice)">删除</a>
                        <a class="button button-outline button-calm" ng-click="editNow(invoice)">修改</a>
                    </div>
                </div>
                <div class="invoice-form invoice-edit" ng-if="invoice.sourceType == '1' && invoice.edit">
                    <div class="invoice-img">
                        <div class="invoice-img-min" ng-uploader="" accept="image/png, image/jpeg, image/gif" url="uploadUrl" done="invoicefuc.done">
                            <img ng-if="previewUrl" ng-src="{{previewUrl}}">
                            <img ng-if="!previewUrl" ng-src="{{invoice.imgUrl}}">
                            <a class="button button-positive">点击上传</a>
                        </div>
                        <div>
                            <span class="item-tit">金额</span>
                            <h3><input type="text" oninput="if(value.length>5)value=value.slice(0,5)" ng-model="invoice.totalMoney"></h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">支付方式</span>
                        <div class="item-select">
                            <h3>
                                <select ng-model="invoice.payType"
                                        ng-options="parseInt(key) as value for (key,value) in PayTypeNames"
                                >
                                </select>
                            </h3><!-- 这里要加一个判断,是否是编辑模式,,-->
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">类型</span>
                        <div class="item-select">
                            <!--<h3>类型</h3>-->
                            <h3>
                                <select ng-model="invoice.type"
                                        ng-options="parseInt(key) as value for (key,value) in InvoiceFeeTypeNames"
                                >
                                </select>
                            </h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">时间</span>
                        <div>
                            <h3>
                                <ng-selector-date ng-model="invoice.invoiceDateTime"
                                                  dlg-title="请选择出差日期"
                                                  dlg-options="dateOptions"
                                                  date-filter="yyyy-MM-dd">
                                </ng-selector-date>
                            </h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">备注</span>
                        <textarea ng-model="invoice.remark"></textarea>
                    </div>
                    <div class="button-bar">
                        <a class="button button-outline button-calm" ng-click="cancelChanges(invoice)">取消</a>
                        <a class="button button-outline button-calm" ng-click="saveChanges(invoice)">确认</a>
                    </div>
                </div>
                <div class="invoice-form from-supplier" ng-if="invoice.sourceType == '2' && !invoice.edit">
                    <div class="invoice-img">
                        <img ng-src="{{getImageUrl(invoice.supplier.logo)}}">
                        <!--<div class="supplier_logo"></div>-->
                        <div>
                            <span class="item-tit">金额</span>
                            <h3>{{invoice.totalMoney}}</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">支付方式</span>
                            <h3 ng-if="invoice.payType == EPayType.PERSONAL_PAY">个人支付</h3>
                            <h3 ng-if="invoice.payType == EPayType.COMPANY_PAY">公司支付</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">类型</span>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.PLANE_TICKET">机票行程单</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.TRAIN_TICKET">火车票</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.HOTEL">住宿费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.ORDER_TICKET_FEE">订票费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.CANCEL_TICKET_FEE">退票费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.TICKET_CHANGE_FEE">改签费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.EXPRESS">快递费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.INSURANCE">保险费</h3>
                            <h3 ng-if="invoice.type == EInvoiceFeeTypes.OTHER">其他</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div>
                            <span class="item-tit">时间</span>
                            <h3>{{invoice.invoiceDateTime | date: 'yyyy-MM-dd'}}</h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <div class="invoice_desc">
                            <span class="item-tit">备注</span>
                            <p>{{invoice.remark}}</p>
                        </div>
                    </div>
                    <div class="button-bar" ng-if="[EPlanStatus.AUDIT_NOT_PASS,EPlanStatus.WAIT_UPLOAD,EPlanStatus.WAIT_COMMIT].indexOf(tripDetail.status) >= 0">
                        <a class="button button-outline button-calm" ng-click="unBind(invoice)">解除绑定</a>
                    </div>
                </div>
            </ion-slide>
            <ion-slide class="choose" ng-if="showChooseFunc">
                <div class="chooseFun" ng-if="select_menu">
                    <div class="chooseBtn">
                        <a class="button button-calm" ng-click="linkOthers()">关联订单</a>
                        <a class="button button-calm button-outline" ng-click="manual()">手动添加</a>
                    </div>
                </div>
                <div class="addInvoice invoice-form invoice-edit" ng-if="!select_menu">
                    <div class="invoice-img">
                        <div class="invoice-img-min" ng-uploader="" accept="image/png, image/jpeg, image/gif" url="uploadUrl" done="invoicefuc.done">
                            <img ng-if="previewUrl" ng-src="{{previewUrl}}">
                            <img ng-if="!previewUrl" src="ionic/images/invoiceEmpty.png">
                            <a class="button button-positive">点击上传</a>
                        </div>
                        <div>
                            <span class="item-tit">金额</span>
                            <h3><input type="number" oninput="if(value.length>5)value=value.slice(0,5)" ng-model="newInvoice.totalMoney"></h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">支付方式</span>
                        <div class="item-select">
                            <h3>
                                <select ng-model="newInvoice.payType">
                                    <option value="{{EPayType.PERSONAL_PAY}}" ng-selected="newInvoice.payType == EPayType.PERSONAL_PAY">个人支付</option>
                                    <option value="{{EPayType.COMPANY_PAY}}" ng-selected="newInvoice.payType == EPayType.COMPANY_PAY">公司支付</option>
                                </select>
                            </h3><!-- 这里要加一个判断,是否是编辑模式,,-->
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">类型</span>
                        <div class="item-select">
                            <!--<h3>类型</h3>-->
                            <h3>
                                <select ng-model="newInvoice.type">
                                    <option value="{{EInvoiceFeeTypes.PLANE_TICKET}}" ng-selected="invoice.type == EInvoiceFeeTypes.PLANE_TICKET">机票行程单</option>
                                    <option value="{{EInvoiceFeeTypes.TRAIN_TICKET}}" ng-selected="invoice.type == EInvoiceFeeTypes.TRAIN_TICKET">火车票</option>
                                    <option value="{{EInvoiceFeeTypes.HOTEL}}" ng-selected="invoice.type == EInvoiceFeeTypes.HOTEL">住宿费</option>
                                    <option value="{{EInvoiceFeeTypes.ORDER_TICKET_FEE}}" ng-selected="invoice.type == EInvoiceFeeTypes.ORDER_TICKET_FEE">订票费</option>
                                    <option value="{{EInvoiceFeeTypes.CANCEL_TICKET_FEE}}" ng-selected="invoice.type == EInvoiceFeeTypes.CANCEL_TICKET_FEE">退票费</option>
                                    <option value="{{EInvoiceFeeTypes.TICKET_CHANGE_FEE}}" ng-selected="invoice.type == EInvoiceFeeTypes.TICKET_CHANGE_FEE">改签费</option>
                                    <option value="{{EInvoiceFeeTypes.EXPRESS}}" ng-selected="invoice.type == EInvoiceFeeTypes.EXPRESS">快递费</option>
                                    <option value="{{EInvoiceFeeTypes.INSURANCE}}" ng-selected="invoice.type == EInvoiceFeeTypes.INSURANCE">保险费</option>
                                    <option value="{{EInvoiceFeeTypes.OTHER}}" ng-selected="invoice.type == EInvoiceFeeTypes.OTHER">其他</option>
                                </select>
                            </h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">时间</span>
                        <div>
                            <!--<h3>2016-05-23</h3>-->
                            <h3>
                                <ng-selector-date ng-model="newInvoice.invoiceDateTime"
                                                  dlg-title="请选择出差日期"
                                                  dlg-options="dateOptions"
                                                  date-filter="yyyy-MM-dd">
                                </ng-selector-date>
                            </h3>
                        </div>
                    </div>
                    <div class="invoice-item">
                        <span class="item-tit">备注</span>
                        <textarea ng-model="newInvoice.remark"></textarea>
                    </div>
                    <div class="button-bar">
                        <a class="button button-outline button-calm" ng-click="backToChooese()">取消</a>
                        <a class="button button-outline button-calm" ng-click="createInvoice()">确认</a>
                    </div>
                </div>
            </ion-slide>
        </ion-slide-box>
    </ion-content>
    <div class="bar bar-footer bar-positive" ng-if="invoice.status == EPlanStatus.WAIT_COMMIT || invoice.status == EPlanStatus.AUDIT_NOT_PASS">
        <div class="button button-full button-positive" style="margin-top: 0;width: 100%;font-size: 20px;" ng-uploader accept="image/png, image/jpeg, image/gif" title="invoicefuc.title" done="invoicefuc.done" url="uploadUrl">重新上传</div>
    </div>
    <div class="bar bar-footer bar-positive" ng-if="invoice.status == EPlanStatus.AUDITING || invoice.status == EPlanStatus.COMPLETE">
        <div class="button button-full button-positive" style="margin-top: 0;width: 100%;font-size: 20px;" ng-click="backtodetail()">返回详情</div>
    </div>
</ion-view>