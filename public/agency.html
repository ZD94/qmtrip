<!DOCTYPE html>
<html lang="zh-cn">
<html ng-app="tulingdao.com">
<head>
	<meta charset="UTF-8">
	<title ng-bind="pageTitle">代理商管理</title>
	<link rel="stylesheet" type="text/css" href="/agency/css/common.css">
	<link rel="stylesheet" type="text/css" href="/agency/css/public.css">
	<link rel="stylesheet" type="text/css" href="/agency/css/login.css">
	<link rel="stylesheet" type="text/css" href="/agency/css/companylist.css">
	<link rel="stylesheet" type="text/css" href="/agency/css/travelrecord.css">
	<script type="text/javascript" src="/script/libs/bundle.jquery.js"></script>
    <script type="text/javascript" src="/script/libs/bundle.api.js"></script>
    <script type="text/javascript" src="/script/libs/bundle.ngapp.js"></script>
    <script type="text/javascript" src="/script/messagebox.js"></script>
    <script type="text/javascript" src="/script/selectbox.js"></script>
    <script type="text/javascript" src="/script/header.js"></script>
    <script type="text/javascript" src="/agency/controller.all.js"></script>
    <script type="text/javascript">
    	var Q = require('q');
    	var moment = require('moment');
		var Cookie = require('tiny-cookie');
		var TLD = TLD_angular_app('tulingdao.com');
		TLD.config(function ($stateProvider, $urlRouterProvider) {
            $urlRouterProvider.otherwise('/companyList/CompanyList');
            $stateProvider
                    .state("login", {
                        url: "/login/:path",
                        controllerProvider: function ($injector, $stateParams){
                            $stateParams.path = 'login/' + $stateParams.path;
                            return $injector.invoke(TLD_angular_app_defaultControllerProvider, this, {$stateParams:$stateParams});
                        },
                        templateUrl: function (params) {
                            return '/agency/login/' + params.path + ".html";
                        }
                    })
                    .state("root", {
                        url: "",
                        abstract: true,
                        controllerProvider: TLD_angular_app_defaultControllerProvider,
                        templateUrl: function (params) {
                            return '/agency/index.html';
                        }
                    })
                    .state("root.content", {
                        url: "/*path",
                        controllerProvider: TLD_angular_app_defaultControllerProvider,
                        templateUrl: function (params) {
                            return '/agency/' + params.path + ".html";
                        }
                    });
        });
    	API.onlogin(function(){
    		var backurl = window.location.href;
    		return gotoAgentLogin(backurl);
    	});

    	function gotoAgentLogin(backurl) {
    		backurl = encodeURIComponent(backurl);
    		window.location.href = '/agency.html#/login/login?backurl='+backurl;
    	}

	    API.authenticate = function(remote, callback){
	        var agent_id = Cookie.get('agent_id');
	        var token_id = Cookie.get('agent_token_id');
	        var token_sign = Cookie.get('agent_token_sign');
	        var timestamp = Cookie.get("agent_token_timestamp");
            remote.authenticate({ accountid: user_id, tokenid: token_id, tokensign: token_sign, timestamp: timestamp },
                    callback);
	    };

  //   	function logout(){
		// 	API.require('auth');
		// 	API.onload(function(){
		// 		API.auth.logout()
		// 			.then(function (data) {
		// 				console.info(data);
		// 				location.reload();
		// 			}).catch(function(error){
		// 				console.log(error);
		// 		}).done();
		// 	});
		// };
    	//获取页面基本信息

    	// TLD.controller("MainController", ["$scope", function($scope) {
    	// 	API.require("agency");
    	// 	API.onload(function(){
    	// 		API.agency.getCurrentAgency()
    	// 			.then(function(ret){
    	// 				console.info(ret);
    	// 				$scope.agency = ret;
    	// 				$scope.$apply();
    	// 			})
    	// 			.catch(function(err){
    	// 				console.info(err)
    	// 			})
    	// 	})

    	// }])
    </script>
</head>
<body>
	<div id="angular-view" ui-view></div>
</body>
</html>