<!DOCTYPE html>
<html lang="zh-cn">
<html ng-app="tulingdao.com">
<head>
	<meta charset="UTF-8">
	<title ng-bind="pageTitle">代理商管理</title>
	<link rel="stylesheet" type="text/css" href="/agency/css/common.css">
	<link rel="stylesheet" type="text/css" href="/agency/css/public.css">
	<link rel="stylesheet" type="text/css" href="/agency/css/companylist.css">
	<script type="text/javascript" src="/script/libs/bundle.jquery.js"></script>
    <script type="text/javascript" src="/script/libs/bundle.angular.js"></script>
    <script type="text/javascript" src="/script/libs/bundle.api.js"></script>
    <script type="text/javascript" src="/script/libs/api.js"></script>
    <script type="text/javascript" src="/script/libs/ngapp.js"></script>
    <script type="text/javascript" src="/script/messagebox.js"></script>
    <script type="text/javascript" src="/script/selectbox.js"></script>
    <script type="text/javascript" src="/script/header.js"></script>
    <script type="text/javascript" src="/agency/controller.all.js"></script>
    <script type="text/javascript">
    	var Q = require('q');
    	var Cookie = require("tiny-cookie");
    	var moment = require('moment');
    	var TLD = TLD_angular_app('tulingdao.com', 'agency', '/UsersFirst/UserMain');
    	API.onlogin(function(){
    		var backurl = window.location.href;
    		return gotoAgentLogin(backurl);
    	});

    	function gotoAgentLogin(backurl) {
    		backurl = encodeURIComponent(backurl);
    		window.location.href = '/agency/login.html#/login/login?backurl='+backurl;
    	}

	    API.authenticate = function(remote, callback){

	        var agent_id = Cookie.get('agent_id');
	        var token_id = Cookie.get('token_id');
	        var token_sign = Cookie.get('token_sign');
	        var timestamp = Cookie.get("timestamp");

	       	if (!(agent_id && token_id && token_sign && timestamp)) {
	       		var backurl = window.location.href;
	    		return gotoAgentLogin(backurl);
	    	}
	        remote.authenticate(agent_id, token_id, timestamp, token_sign, callback);
	    };

    	function logout(){
			API.require('auth');
			API.onload(function(){
				API.auth.logout()
					.then(function (data) {
						console.info(data);
						location.reload();
					}).catch(function(error){
						console.log(error);
				}).done();
			});
		};
    	//获取页面基本信息
    	TLD.controller("MainController", ["$scope", function($scope) {
    		API.require("agency");
    		API.onload(function(){
    			// API.authenticate()
    			// 	.then(function(ret){
    			// 		console.info(ret)
    			// 		$scope.$apply;
    			// 	})
    			// 	.catch(function(err){
    			// 		console.info(err)
    			// 	})
    			API.agency.getCurrentAgency()
    				.then(function(ret){
    					console.info(ret);
    					$scope.agency = ret;
    					$scope.$apply();
    				})
    				.catch(function(err){
    					console.info(err)
    				})
    		})

    	}])
    </script>
    <script type="text/javascript">
    $(function(){
    	$(window).resize(function(){resize();})
    	$(".left_nav a").click(function(){
    		var $that = $(this).closest("li");
    		$(".left_nav li").removeClass("on");
    		$that.addClass("on");
    	})
    	function resize(){
    		var ww = $(window).width();
    		$(".corp_m_header").css("width",ww-200);
    	}
    	resize();
    	$()
    })
    </script>
</head>
<body ng-controller="MainController">
	<div class="corp_header">
		<div class="logo">
			<img src="/corp/images/logo.png">
		</div>
		<ul class="left_nav">
			<li class="on">
				<a href="">待审核出差记录</a>
			</li>
			<li>
				<a href="#/companyList/companylist">公司管理</a>
			</li>
			<li>
				<a href="">用户管理</a>
			</li>
			<li>
				<a href="">数据统计</a>
			</li>
		</ul>
	</div>
	<div class="corp_main">
		<div class="corp_m_header">
			<div class="m_headerleft">
				<div class="corp_name"></div>
				<div class="corp_help">帮助</div>
			</div>
			<div class="m_headerright">
				<span class="header_account" id="account">您好，<a href="">{{agency.name || agency.mobile}}</a><em class="web-icon-font">&#xf0d7;</em></span>
				<div id="account_menu" class="account_menu">
					<ul>
						<li><a href="">修改密码</a></li>
						<li><a href="javascript: logout();">退出</a></li>
					</ul>
				</div>
			</div>
		</div>
		<div class="corp_box">
			<div class="c_boxmain">
				<div id="angular-view" ui-view></div>
			</div>
		</div>
		<div class="corp_m_footer">
			<p>由途灵岛信息股份有限公司提供技术支持</p>
			<p>联系电话：010-57371105</p>
		</div>
	</div>
</body>
</html>