<!DOCTYPE html>
<html lang="zh-cn">
<html>
<head>
	<meta charset="UTF-8">
	<title ng-bind="pageTitle"></title>
	<link rel="stylesheet" type="text/css" href="/corp/css/common.css">
	<link rel="stylesheet" type="text/css" href="/corp/css/public.css">
	<link rel="stylesheet" type="text/css" href="/corp/css/user.css">
	<link rel="stylesheet" type="text/css" href="/corp/css/staffmanage.css">
	<link rel="stylesheet" type="text/css" href="/corp/css/staffawardplan.css">
	<link rel="stylesheet" type="text/css" href="/corp/css/travelstatisics.css">
	<link rel="stylesheet" type="text/css" href="/corp/css/policylist.css">
	<script type="text/javascript" src="/script/libs/bundle.jquery.js"></script>
    <script type="text/javascript">
        var jQuery = $ = require('jquery');
    </script>
    <script type="text/javascript" src="/script/libs/bundle.api.js"></script>
	<script type="text/javascript" src="/script/jqPaginator.js"></script>
	<script type="text/javascript" src="/script/libs/bundle.ngapp.js"></script>
	<script>
		var Cookie = require('tiny-cookie');
		function isAuthCreditExist() {
			var user_id = Cookie.get('user_id');
			var token_id = Cookie.get('token_id');
			var token_sign = Cookie.get('token_sign');
			var timestamp = Cookie.get("timestamp");

			if (user_id && token_id && token_sign && token_id) {
				return true;
			}
			return false;
		}
		if (!isAuthCreditExist()) {
			window.location.href = "/staff.html#/auth/login?backurl="+window.location.href;
		}
	</script>
	<script src="http://echarts.baidu.com/build/dist/echarts-all.js"></script>
	<script type="text/javascript" src="/script/libs/bundle.notie.js"></script>
    <script type="text/javascript" src="/script/selectbox.js"></script>
    <script type="text/javascript" src="/script/header.js"></script>
    <script type="text/javascript" src="/script/jquery.ajaxfileupload.js"></script>
    <script type="text/javascript" src="/corp/controller.all.js"></script>
    <script type="text/javascript">
    	var Q = require('q');
    	var moment = require('moment');
		var TLD = TLD_angular_app('tulingdao.com', 'corp', '/UsersFirst/UserMain');
		API.onlogin(function(){
			var backUrl = window.location.href;
			backUrl = encodeURIComponent(backUrl);
			window.location.href = "/staff.html#/auth/login?backurl="+backUrl;
		});
		API.authenticate = function(remote, callback){
			var user_id = Cookie.get('user_id');
			var token_id = Cookie.get('token_id');
			var token_sign = Cookie.get('token_sign');
			var timestamp = Cookie.get("timestamp");
			remote.authenticate({ accountid: user_id, tokenid: token_id, tokensign: token_sign, timestamp: timestamp },
					callback);
		};
		function logout(){
			API.require('auth');
			API.onload(function(){
				API.auth.logout()
						.done(function() {
							Cookie.remove("user_id");
							Cookie.remove("token_id");
							Cookie.remove("token_sign");
							Cookie.remove("timestamp");
							window.location.href = "/staff.html#/auth/login";
						});
			});
		};
    	//获取页面基本信息
    	TLD.controller("MainController", ["$scope", function($scope) {
    		API.require("company");
    		API.require("staff");
			var companyId;
    		API.onload(function(){
    			API.staff.getCurrentStaff()
    				.then(function(ret){
    					$scope.staff = ret;
    					var company_id = ret.companyId;
							companyId = company_id;
    					return API.company.getCompanyById(company_id)
		    				.then(function(company){
		    					$scope.company = company;
		    					var companyName = company.name;
		    					if (companyName.length>30) {
		    						$scope.companyName = companyName.substr(0,29) + '…';
		    					}else{
		    						$scope.companyName = companyName;
		    					}
		    					$scope.$apply();
		    				})
    					$scope.$apply();
    				})
    				.catch(function(err){
    					TLDAlert(err);
    				})
    		})
    	}])
    </script>
    <script type="text/javascript">
    $(function(){
    	$(window).resize(function(){resize();})
    	$(".left_nav a").click(function(){
    		var $that = $(this).closest("li");
    		$(".left_nav li").removeClass("on");
    		$that.addClass("on");
    	})
    	function resize(){
    		var ww = $(window).width();
    		$(".corp_m_header").css("width",ww-200);
    	}
    	resize();
    	$()
    })
    </script>
</head>
<body ng-controller="MainController" ng-app="tulingdao.com">
	<div class="corp_header">
		<div class="logo">
			<img src="/corp/images/logo.png">
		</div>
		<ul class="left_nav">
			<li>
				<a href="#/UsersFirst/UserMain"><span class="web-icon-font3">&#xe916;</span>差旅管理首页</a>
			</li>
			<li>
				<a href="#/TravelStatistics/SettlementInfo"><span class="web-icon-font3">&#xe908;</span>出差统计</a>
			</li>
			<li>
				<a href="#/StaffManage/StaffInfoManage"><span class="web-icon-font3">&#xe91D;</span>员工信息管理</a>
			</li>
			<li>
				<a href="#/TravelPolicy/PolicyList"><span class="web-icon-font3">&#xe905;</span>差旅标准设置</a>
			</li>
			<li>
				<a href="#/StaffAwardPlan/StaffAwardPlan"><span class="web-icon-font3">&#xe91c;</span>员工奖励计划</a>
			</li>
		</ul>
	</div>
	<div class="corp_main">
		<div class="corp_m_header">
			<div class="m_headerleft">
				<div class="corp_name">{{companyName}}</div>
				 <!--<div class="corp_help">帮助</div> -->
				 <!--<div class="corp_edit" ng-click="goEditCorp()">修改资料</div>-->
			</div>
			<div class="m_headerright">
				<span class="header_account" id="account">您好，<a href="">{{staff.name}}</a><em class="web-icon-font">&#xf0d7;</em></span>
				<div id="account_menu" class="account_menu">
					<ul>
						<li><a href="staff.html#/auth/changePwd">修改密码</a></li>
						<li><a href="javascript: logout();">退出</a></li>
					</ul>
				</div>
				<a href="/staff.html" class="getplan">出差计划</a>
			</div>
		</div>
		<div class="corp_box">
			<div class="c_boxmain">
				<div id="angular-view" ui-view></div>
			</div>
		</div>
		<div class="corp_m_footer">
			<p>由途灵岛（北京）信息技术股份有限公司提供技术支持&nbsp; &nbsp;联系电话：010-57371105</p>
			<p>Copyright©2016 tulingdao.All Rights Reserved.京ICP备14028756号.途灵岛信息技术版权所有</p>
		</div>
	</div>
	<script type="text/javascript" src="/script/messagebox.js"></script>
</body>
</html>